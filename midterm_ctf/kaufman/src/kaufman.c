// gcc -Wl,-z,norelro -fstack-protector problem.c -o chal.bin

#include <stdio.h>
#include <stdint.h>
#include <string.h>
#include <stdlib.h>

char review[1000];
char *review_names[5];

void quote1() {
    printf("\"You and I share the same DNA. Is there anything more lonely than that?\"\n");
    // Move %rdi to %rsi
    __asm__("mov %rdi, %rsi;"
            "jmp %r8");
}

void quote2() {
    printf("\"Constantly talking isn't necessarily communicating.\"\n");
    // Dispatch
    __asm__("add $8, %r9;"
            "jmp (%r9)");
}

void quote3() {
    printf("\"What I came to understand is that change is not a choice... It happens, and you are different.\"\n");
    // Bit shift %rdi to left
    __asm__("shl $1, %rdi;"
            "jmp %r8");
}

void quote4() {
    printf("\"We're all hurling towards death. Yet here we are, for the moment, alive. Each of us knowing we're going to die. Each of us secretly believing we won't.\"\n");
    // Set %rdi to zero
    __asm__("xor %rdi, %rdi;"
            "jmp %r8");
}

void quote5() {
    printf("\"Meet me in Montauk...\"\n");
    // Jump to dispatch
    __asm__("mov %0, %%r8;"
            "mov %1, %%r9;"
            "add $14, %%r8;"
            "jmp %%r8"
            :
            : "g" (quote2), "g" (review));
}

void quote6() {
    printf("\"Sand is overrated. It's just tiny little rocks.\"\n");
    // Add one to %rdi
    __asm__("add $1, %rdi;"
            "jmp %r8");
}

void win(uint64_t arg1, uint64_t arg2) {
    int flag = fopen("flag.txt", "r");
    if (arg1 == 0xdeadbeef && arg2 == 0xcafebabe) {
        char buff[256];
        fgets(buff, 255, flag);

        printf("--------------------------------------------------------------------------------\n\n");
        printf("\"... as the world forgets you; as you recognize your transience; as you begin\n");
        printf("to lose your characteristics one by one; as you learn there is no-one watching\n");
        printf("you, and there never was, you think only about driving - not coming from any\n");
        printf("place; not arriving any place. Just driving, counting off time. Now you are\n");
        printf("here, at 7:43. Now you are here, at 7:44. Now you are...\n\n");
        printf("Gone.\"\n\n");
        printf("--------------------------------------------------------------------------------\n\n");

        printf("%s\n", buff);
        return;
    }
    printf("\"The end is built into the beginning\"\n");
}

void fill_reviews() {
    review_names[0] = malloc(16);
    strcpy(review_names[0], "Kaden");
    review_names[1] = malloc(16);
    strcpy(review_names[1], "Jake");
    review_names[2] = malloc(16);
    strcpy(review_names[2], "Joel");
    review_names[3] = malloc(16);
    strcpy(review_names[3], "Michael");
    review_names[4] = malloc(16);
    strcpy(review_names[4], "Charlie");
}

void logo() {
    puts("&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&%&&&&&&&&&&&&&%%%&&%%&%%%%%%%%%%%%%%%%%%%%%%%&%%%");
    puts("&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&%&%&&&&%%&%%%&%%%&%%%%%%%%%%%%%%%%%%%");
    puts("&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&@@@&@&@&@@@@&@&&&&&&%&&%&%%&&&%%%%%%%%%%%%%%%%%%%");
    puts("&&&&&&&&&&&&&&&&&&&&@@@@&@@@&&@@@@@@@@@@@@@&@@&&@&&%%&&&&%%%%&%%%%%%%%%%%%##%%%%");
    puts("&&&&&&&&&&&&&&&&&&@@@@@@@@@@@@@@@@@@@@&@@@@@@@@&@@&&&&&&&&&&&&&&&%%%%%%%%%%%%%#%");
    puts("&&&&&&&&&&&&%&&&&&@&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&@@&@&&&&&&%&&&%%%%%%%#%#%%%");
    puts("&&&&&&&&&&&&&&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&@&&&&&&%%&@&%%%%%%%%%%%");
    puts("&&&&&&&&&&&&&@@@@&&@&@@@@@&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&&@@&&&&&%%%%%%%#%%%%%");
    puts("&&&%&%%%&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&@@@@@&@@@@@@@&&&&&&%%&%#%%%%#%#");
    puts("&&&&&%&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@&@@@@@@@@@@@@@@&@@&@&@@@@@@@@@&&&&@%##%%#%%%");
    puts("&&&&&&&&&@@@@@@@@@@@@@@@@@@&@&@@@@@@@@@@@@@&@@@@@@@@@@@@&@@@&@@@&@@@&@@@%%%%%%%%");
    puts("&&&&&&&@@&@@@@@@@@&@@&@&@@@@@&&&&@&@@@@@@@@@@@@@@@@@@@@@@&@@&@@@@@@@&&@@&%%%%%%%");
    puts("%&&&&%%&&@@@@@@@@@@@&@@@@@@@@#%%@&%&%&@&@@&@@@@@&@&@@@@@&@@@@@@@@@@@@@&%&&%%#%%%");
    puts("%%%&%%&@&@@@@@@@@@%%&&%%#((((%/#*(%#&%%%&&&%@@@#/(##&@@@@@@@@&@@&@@@@@&@&&%%%%%%");
    puts("%%&%&%%@@@@@@@@@@####(///*///*///#(%##**/%&&#&&@##*/(&@&@@@@@@@@@@@@@@@@&&%%%#%%");
    puts("%%%%&&&&@@@&@@@@@#(///(**,,*,,,,*,,,**/*,(@%&%%(%(&(#/&&&&&@@@@@@@@@@@@@&%%&&%%%");
    puts("&%&&@@&@@@@@@@@@##/(/*/*/**,,**,*,,,,,,,///*/%%(*(//*(#&@@@@@@@@@@@@@@@@@@@&%#%%");
    puts("%%%%%&@@@@@@@@@@#%///////,*/**,*,,**,,,,,,,,,,*,******#&&@@@@@@@&@@@@@@@@@&@@%%%");
    puts("%%%&&@@@@@@@@@@@&#///*******,,,,,,,,,,,,.,,,,,,********#@&@@@@@@@@@@@@@@@@@&&%%%");
    puts("%%%&@@@@@@@@@@@@@#(///*,**,,,,.,,,,*,,,,,,.,,****,*/***(&@@@&&@@@@@@@@@@@@&&%##%");
    puts("%%%%@@@@@@@@@@@@@%##(#&#%#/*,**,*,***//#####/*/*/(((///#&@@@&@@%%&&@&@@@@@%%%%%%");
    puts("%%%%%@@@@@@@#@@@&&##&&&@@&@@&&/***,/(&@&&(@&&&&&@@&&&&%##%&@@@@&&&&@@@@@@@&&&%%%");
    puts("%%%%%&&&@@@@@@&%#%%%%((#&#(##&&%*/#&/(####/((/////@@@@***/&@(&%&&@@@@@@@&@@&&%%%");
    puts("%%%%#%%%%&@@@@@%#(((#(///((((&@*,,,%(/(((/*/*/***/*@,***/#&#&//*##*(@@&&@&&%%%%%");
    puts("%%%#%%%%#%@@@&&&#(/***,*****(@(*,,,*&(****,**,***,&***///&&&&(/***/@@&&%%%%%%%%%");
    puts("%%%%#%%%%%%%%%%&@@&/(*****/@&(//,,,**(&%**,,,,,***,***//&@@%#/*,,*@@@@@%%%%%&%%%");
    puts("%%%%%%%%%%%%%%&&%&(//*****((((*,,,,*,*,(*/,,******,***//&%@&#/***@@@&%%%&%%%%&&%");
    puts("%%%%%%%%%%%%%%%%&@%(/**//(/(%%(/*/#(/#///(*(/***,******(%&@&&(%@&@@@&%%%%%%%%%&%");
    puts("%%%%%%%%%%%%%%%%&@&#(/(%##&%%##%#%&%%(&&##%#(%&#////((%&&%%&%&&%&%%&%%%%%%%%%%%%");
    puts("%%%%%%%%%%%%%%%%@&&%#%&&&@@#&%%%&&##%%&(#&&%&&&%%(%#%%&%&&&@%(&%&%%%%%%%%%%%%#%#");
    puts("%%%%%%%%%%&%#%%%@@%&&&&@@@@@#%%%%&&&&&&%%%((#&&%#&%&&&&%&@&&(*,%%%%%%###%#%#####");
    puts("%%%%%%&%%%%%%%%#%@&&&&%&%&%#((//********(///&%@%&#%&%&&&@@%((.,(%%##%#%#########");
    puts("&&%%%%%%%%%%%%%%%&&&@@&&&%@%%%(&(/%##%##%%#(&&%&@@@&@&&&&(,,,,(.((%%############");
    puts("%%%%%%%%%%%%%%%%%%%&@&@&@&&&%#&%(%&&/%%#&%%%%&%&&#@&@&%%#/.*(/( ,((,.*(#########");
    puts("%%%%%%%%%%%%%%%%%%%&&&&&@@@&%%&&%%%&(%%#%&(%%&&%&&%&&%(.,,,////(((,.,//,.*,,,(##");
    puts("%%%%%%%%%%%%%%%%%%%%%%&&@%(%#&&%#%%&(%%#%%((&&&&@&(#*./,,****///*././,.*......,,");
    puts("&%&%%%%%%%%%%%%%%%%%%%%%%#&#%&@&%&%&&%%%%&&&&&&&(,..*  ** * ****.,.,*..,**,*.,,.");
    puts("%%%&%%%%%%%%%%%%%%%%%%%%/%%%%@&&%@&@@@@@@&%&@*/.../, ,**** **/*..,.*..**..,*. *.");
    puts("&&&%&%&&&%%%%%%%%%%%%%%*(#(##&@%&(#(##%%%&/ *,.../ .********.**.**,.,*/..,*.**..");
    puts("&&%&%%%%&&%%%%&%%%%%%%(,(((##%@%###%%%##,#,.,, *,.*******, ..****,.*/...%(..//*,");
    puts("&&%&&%%%%%%%#%%%%&%/*,(#,/(#(#&@%####./*#(/,  *.(* *, /(/   ,**/ .**  (*.*. ,(**");
    puts("%&&&%&&%%%%%%%%%**/*/*/*/,*//((@@(#,/,,,(***,*,**** **/. . .*//../  /,/..*. ****");
    puts("&&&&&&%%%%%%#/****//****%%%&/.(#@&. .*,.  **%,******(*....*// .,, .*,,..,*...,.,");
}

int main() {
    fill_reviews();
    printf("--------------------------------------------------------------------------------\n\n");
    logo();
    printf("--------------------------------------------------------------------------------\n\n");
    printf("\"Everything is more complicated than you think. You only see a tenth of what is\n");
    printf("true. There are a million little strings attached to every choice you make; you\n");
    printf("can destroy your life every time you choose. But maybe you won't know for twenty\n");
    printf("years. And you'll never ever trace it to its source. And you only get one chance\n");
    printf("to play it out. Just try and figure out your own divorce. And they say there is\n");
    printf("no fate, but there is: it's what you create. Even though the world goes on for\n");
    printf("eons and eons, you are here for a fraction of a fraction of a second. Most of\n");
    printf("your time is spent being dead or not yet born. But while alive, you wait in\n");
    printf("vain, wasting years, for a phone call or a letter or a look from someone or\n");
    printf("something to make it all right. And it never comes or it seems to but doesn't\n");
    printf("really. And so you spend your time in vague regret or vaguer hope for something\n");
    printf("good to come along. Something to make you feel connected, to make you feel whole,\n");
    printf("to make you feel loved.\"\n\n");
    printf("--------------------------------------------------------------------------------\n\n");

    printf("Please enter your review: \n");
    printf(">>> ");
    fflush(stdout);
    fgets(review, 1000, stdin);

    char num_str[10];
    printf("Which reviewer number do you want to be? \n");
    printf(">>> ");
    fflush(stdout);
    fgets(num_str, 10, stdin);
    int num = atoi(num_str);
    if (num >= 5)
        exit(0);

    char name[9];
    printf("What is your name? \n");
    printf(">>> ");
    fflush(stdout);
    fgets(name, 9, stdin);
    memcpy(review_names[num], name, 8);

    exit(0);
}